<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtue | INTRANET</title>
    <link rel="shortcut icon" href="../media/VH_new.png" type="image/x-icon">
</head>

<body>
    <h1 class="greetingMsg">Welcome, </h1>
    <img src="" class="userProfile" alt="">
    <a href="loa.html">Leave of Absence</a>

    <script src="../scripts/intra.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const userData = JSON.parse(localStorage.getItem('discordUserData'));

            if (userData) {
                const usernameElement = document.querySelector('.greetingMsg');
                const avatarElement = document.querySelector('.userProfile');

                usernameElement.textContent = "Welcome, " + userData.username;
                avatarElement.src = `https://cdn.discordapp.com/avatars/${userData.id}/${userData.avatar}.png`;

                // Remove the code parameter from the URL
                const urlParams = new URLSearchParams(window.location.search);
                urlParams.delete('code');
                const newUrl = `${window.location.pathname}${urlParams.toString() ? `?${urlParams.toString()}` : ''}`;

                // Update the URL without the code parameter
                history.replaceState({}, document.title, newUrl);
            } else {
                // If user data is not available, redirect to sign-in page
                window.location.href = '../index.html';
                const warningElement = document.querySelector('.warning');
                warningElement.style.display = 'block';
                warningElement.textContent = 'Unauthorised user detected.';
            }
        });
    </script>
</body>

</html>